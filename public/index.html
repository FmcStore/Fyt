<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YT-DL | Risograph Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Unbounded:wght@400;900&display=swap" rel="stylesheet">
    <style>
        body {
            background-color: #f4f1de; 
            font-family: 'Unbounded', sans-serif;
            background-image: url("https://www.transparenttextures.com/patterns/60-lines.png");
        }
        .neo-brutal {
            border: 4px solid #000;
            box-shadow: 8px 8px 0px #000;
            transition: all 0.2s ease;
        }
        .neo-brutal:active {
            box-shadow: 2px 2px 0px #000;
            transform: translate(4px, 4px);
        }
        .risograph-pink { background-color: #ff4d6d; color: white; }
        .risograph-blue { background-color: #00b4d8; color: black; }
        .risograph-yellow { background-color: #fee440; color: black; }
    </style>
</head>
<body class="p-6">
    <div class="max-w-2xl mx-auto mt-10">
        
        <header class="neo-brutal risograph-pink p-6 mb-10 rotate-[-1deg]">
            <h1 class="text-4xl font-black uppercase tracking-tighter">Youtube DL</h1>
            <p class="font-bold uppercase text-sm">Fast, Raw, Brutal.</p>
        </header>

        
        <div class="neo-brutal bg-white p-6 mb-10 rotate-[1deg]">
            <div class="flex flex-col gap-4">
                <input id="urlInput" type="text" placeholder="PASTE YOUTUBE URL HERE..." 
                    class="w-full p-4 border-4 border-black font-bold focus:outline-none placeholder-gray-500">
                
                <div class="flex gap-2">
                    <button onclick="download('video')" class="flex-1 neo-brutal risograph-yellow p-4 font-black uppercase">Video</button>
                    <button onclick="download('audio')" class="flex-1 neo-brutal risograph-blue p-4 font-black uppercase">Audio</button>
                </div>
            </div>
        </div>

        
        <div id="loader" class="hidden text-center font-black animate-bounce text-2xl uppercase">Processing...</div>
        
        <div id="result" class="hidden neo-brutal bg-white p-6 rotate-[-1deg]">
            <img id="thumb" class="w-full border-4 border-black mb-4" src="" alt="Thumbnail">
            <h2 id="title" class="text-xl font-black mb-2 uppercase"></h2>
            <p id="info" class="font-bold mb-4 opacity-70"></p>
            <a id="downloadBtn" href="#" target="_blank" class="block text-center neo-brutal risograph-pink p-4 font-black uppercase">Click to Download</a>
        </div>
    </div>

    <script>
  async function download(type) {
    const urlInput = document.getElementById('urlInput');
    const url = urlInput.value;
    if (!url) return alert('Paste URL-nya dulu boss!');

    const loader = document.getElementById('loader');
    const result = document.getElementById('result');
    
    loader.classList.remove('hidden');
    result.classList.add('hidden');

    try {
        const response = await fetch('/api/download', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ url, type })
        });

        // Cek jika response bukan JSON (seperti error 504 Vercel)
        const contentType = response.headers.get("content-type");
        if (!contentType || !contentType.includes("application/json")) {
            throw new Error("Server sedang sibuk (Timeout). Coba klik lagi.");
        }

        const data = await response.json();
        
        if (data.error) {
            alert(data.error);
            return;
        }

        document.getElementById('thumb').src = data.info.thumbnail;
        document.getElementById('title').innerText = data.info.title;
        document.getElementById('info').innerText = `${data.info.quality} | ${data.info.size}`;
        document.getElementById('downloadBtn').href = data.download;
        
        result.classList.remove('hidden');
    } catch (err) {
        console.error(err);
        alert('Error: ' + err.message);
    } finally {
        loader.classList.add('hidden');
    }
}
    </script>
</body>
</html>
